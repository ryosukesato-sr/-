# 🏪 店舗不具合フォーム 運用マニュアル（手動更新ガイド）

> **対象者:** 非エンジニアの運用担当者向け

---

## 📌 このシステムの概要

店舗からの不具合報告を受け付けるGoogle フォームの**店舗選択肢**を自動で管理するシステムです。

```
【データの流れ】

  BigQuery（元データ）
       ↓ 自動取得
  スプレッドシート
       ↓ 自動反映
  Google フォーム（店舗選択肢）
```

---

## ⏰ 自動更新のタイミング

| 処理 | 実行時間 | 内容 |
|------|---------|------|
| データ取得 | **毎日 深夜 2:00** | BigQueryから最新の店舗・ユーザー情報を取得 |
| フォーム更新 | **毎日 深夜 2:05** | フォームの選択肢を最新データに更新 |

> ⚠️ **注意:** 上記は設定されたトリガーに依存します。管理者に確認してください。

---

## 🔄 自動更新のロジック

### 通常の流れ

```
1. BigQueryから店舗・ユーザーデータを取得
       ↓
2. スプレッドシートの「店舗リスト」「ユーザーリスト」を更新
       ↓
3. 各リージョン担当者のシートを作成/更新
       ↓
4. Google フォームの選択肢を更新
```

### 手動変更がある場合

```
手動で変更したデータ（ソース: manual）がある場合：

  ├── BigQueryと同じリージョン → 自動データに切替（マージ完了）
  │
  └── BigQueryと異なるリージョン → 手動データを維持
```

**つまり:** 手動で変更したデータは、BigQueryが追いつくまで維持されます！

---

## ✏️ 手動で店舗のリージョンを変更する方法

### いつ使う？

- BigQueryの更新が間に合わない時
- 新規リージョンの店舗を先にフォームに追加したい時
- 店舗のリージョン割り当てを一時的に変更したい時

### 手順

#### Step 1: スプレッドシートを開く

対象のスプレッドシートを開きます。

#### Step 2: カスタムメニューをクリック

画面上部のメニューに **「✏️ 店舗リージョン変更」** があります。

```
ファイル | 編集 | 表示 | ... | ✏️ 店舗リージョン変更
```

#### Step 3: 「店舗のリージョンを変更」を選択

メニューから **「店舗のリージョンを変更」** をクリックします。

#### Step 4: ダイアログで選択

以下のダイアログが表示されます：

```
┌─────────────────────────────────────────┐
│  🏪 店舗リージョン変更                    │
├─────────────────────────────────────────┤
│                                          │
│  1. どの店舗を変更しますか？              │
│  ┌─────────────────────────────────┐    │
│  │ CSW060 新宿店 (現在: A)      ▼  │    │
│  └─────────────────────────────────┘    │
│                                          │
│  2. リージョンは何にしますか？            │
│  ┌─────────────────────────────────┐    │
│  │ F                          ▼    │    │
│  └─────────────────────────────────┘    │
│                                          │
│            [ キャンセル ] [ 決定 ]        │
└─────────────────────────────────────────┘
```

1. **店舗を選択** - 変更したい店舗をプルダウンから選びます
2. **リージョンを選択** - 新しいリージョン（A〜Z）を選びます
3. **「決定」をクリック**

#### Step 5: 自動でフォームまで更新

「決定」を押すと、以下が自動で実行されます：

```
✅ 店舗リストのリージョンを変更
    ↓
✅ ソース列を「manual」に設定
    ↓
✅ フォームの選択肢を更新
    ↓
🎉 完了！（2秒後にダイアログが閉じます）
```

---

## 📊 スプレッドシートの構造

### 店舗リストシート

| A列 | B列 | C列 | D列 | E列 |
|-----|-----|-----|-----|-----|
| 店舗コード | 店舗名 | リージョン | 店舗タイプ | **ソース** |
| CSW001 | 渋谷店 | A | 直営 | auto |
| CSW060 | 新宿店 | **F** | 直営 | **manual** |

- **auto**: BigQueryから自動取得したデータ
- **manual**: 手動で変更したデータ

### ソース列の意味

| ソース | 意味 | 次回の自動更新時 |
|--------|------|-----------------|
| `auto` | BigQueryから取得 | BigQueryの最新データで上書き |
| `manual` | 手動で変更 | BigQueryと同じになるまで維持 |

---

## ❓ よくある質問

### Q: 手動で変更したデータはいつ消える？

**A:** BigQueryのデータが更新されて、手動で設定したリージョンと同じ値になったら自動的に消えます（マージ完了）。

### Q: 新しいリージョン（F, G など）は自動で対応される？

**A:** はい！Region A〜Z まで自動対応します。ユーザーを新しいリージョンに配属すれば、自動でフォームに反映されます。

### Q: 手動変更を取り消したい

**A:** 店舗リストシートで、該当行の「ソース」列を `manual` から `auto` に変更してください。次回の自動更新でBigQueryのデータに戻ります。

### Q: カスタムメニューが表示されない

**A:** スプレッドシートを再読み込み（F5キー）してください。それでも表示されない場合は管理者に連絡してください。

### Q: エラーが出た

**A:** 以下を確認してください：
1. インターネット接続
2. スプレッドシートへのアクセス権限
3. 管理者に連絡

---

## 📞 問い合わせ先

問題が解決しない場合は、システム管理者に連絡してください。

---

## 📝 改訂履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2026-01-06 | 1.0 | 初版作成 |

